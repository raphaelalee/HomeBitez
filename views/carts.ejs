<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Cart - HomeBitez</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Sniglet Font -->
    <link href="https://fonts.googleapis.com/css2?family=Sniglet:wght@700;900&display=swap" rel="stylesheet">

    <style>
        body {
            background: #fdeeda;
            padding: 30px 80px;
            font-family: Arial, sans-serif;
        }

        /* Navbar */
        .navbar-logo {
            font-family: 'Sniglet', cursive;
            font-size: 32px;
            font-weight: 900;
            color: #ff9c07;
        }

        /* Cart Item */
        .cart-item {
            display: flex;
            align-items: center;
            padding: 18px 0;
            border-bottom: 1px solid #ccc;
        }

        .cart-item img {
            width: 85px;
            height: 85px;
            border-radius: 10px;
            object-fit: cover;
            margin-right: 20px;
        }

        .edit-link {
            color: #0066cc;
            margin-left: 10px;
            cursor: pointer;
        }

        .qty-box {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .qty-btn {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: none;
            background: #ffcc7b;
            font-weight: bold;
        }

        .pill {
            padding: 6px 14px;
            border-radius: 20px;
            background: white;
            border: 1px solid #ccc;
            margin-right: 8px;
            font-size: 13px;
        }

        .btn-checkout {
            padding: 12px 35px;
            background: #d9a521;
            color: white;
            border-radius: 8px;
            border: none;
        }

        .btn-back {
            padding: 12px 35px;
            border: 1px solid #d1b26f;
            background: #fff7ea;
            border-radius: 8px;
        }
    </style>
</head>

<body>

<!-- NAVBAR -->
<div class="d-flex justify-content-between align-items-center mb-4">
    <div class="navbar-logo">HomeBitez</div>

    <div>
        <a href="/" class="mx-2">Home</a>
        <a href="/menu" class="mx-2">Menu</a>
        <a href="#" class="mx-2">Contact us</a>
        <a href="/report" class="mx-2">Report Issue</a>
    </div>
</div>

<h5 class="text-muted mb-4">Cart Page</h5>

<!-- CART LIST -->
<% cart.forEach((item, i) => { %>
    <div class="cart-item">
        <img src="/images/flatlay-iron-skillet-with-meat-and-other-food.jpg">

        <div>
            <strong><%= i+1 %>. <%= item.name %></strong>
            <span class="edit-link" data-id="<%= item.id %>" data-name="<%= item.name %>" data-options="<%= item.options %>">Edit</span>
        </div>

        <div class="ms-auto text-end">
            <div>$<%= item.price.toFixed(2) %></div>

            <!-- QUANTITY BUTTONS -->
            <div class="qty-box mt-2">
                <button class="qty-btn decrease" data-id="<%= item.id %>">âˆ’</button>
                <span class="fw-bold"><%= item.quantity %></span>
                <button class="qty-btn increase" data-id="<%= item.id %>">+</button>
            </div>
        </div>
    </div>
<% }) %>

<!-- SUBTOTAL -->
<div class="mt-5">
    <h5>Subtotal: $<%= subtotal.toFixed(2) %></h5>
</div>

<!-- CUTLERY -->
<div class="mt-4">
    <h6>Cutlery</h6>
    <label class="form-check form-switch mt-2">
        <input id="cutlerySwitch" class="form-check-input" type="checkbox">
    </label>
</div>

<!-- PICKUP DATE & TIME -->
<div class="mt-4">
    <h6>Pickup Date & Time</h6>
    <div class="mt-2">
        <input type="date" id="pickupDate" class="pill">
        <input type="time" id="pickupTime" class="pill">
    </div>
</div>

<!-- BUTTONS -->
<div class="mt-5 d-flex gap-3">
    <a href="/menu" class="btn-back">Back to Menu</a>
    <a href="/checkout" class="btn-checkout">Checkout ðŸ›’</a>
</div>

<!-- EDIT POPUP (BOOTSTRAP MODAL) -->
<div class="modal fade" id="editModal">
    <div class="modal-dialog">
        <div class="modal-content p-3">

            <h5>Edit Item</h5>

            <form id="editForm" method="POST" action="/cart/update">
                <input type="hidden" name="id" id="editItemId">

                <label class="mt-3">Special Request</label>
                <input type="text" class="form-control" name="options" id="editOptions">

                <button class="btn btn-warning mt-3">Save</button>
            </form>
        </div>
    </div>
</div>

<!-- JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // OPEN EDIT MODAL
    document.querySelectorAll('.edit-link').forEach(link => {
        link.addEventListener('click', function () {
            document.getElementById('editItemId').value = this.dataset.id;
            document.getElementById('editOptions').value = this.dataset.options || "";

            new bootstrap.Modal(document.getElementById('editModal')).show();
        });
    });

    // QUANTITY + / -
    document.querySelectorAll('.increase, .decrease').forEach(btn => {
        btn.addEventListener('click', function () {
            let id = this.dataset.id;
            let action = this.classList.contains('increase') ? 'increase' : 'decrease';

            fetch('/cart/update', {
                method: 'POST',
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ id, action })
            }).then(() => location.reload());
        });
    });

    // CUTLERY toggle
    document.getElementById("cutlerySwitch").addEventListener("change", (e) => {
        fetch('/cart/cutlery', {
            method: 'POST',
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ enabled: e.target.checked })
        });
    });

    // DATE & TIME
    document.getElementById("pickupDate").addEventListener("change", saveDatetime);
    document.getElementById("pickupTime").addEventListener("change", saveDatetime);

    function saveDatetime() {
        fetch('/cart/pickup', {
            method: 'POST',
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                date: document.getElementById("pickupDate").value,
                time: document.getElementById("pickupTime").value
            })
        });
    }
</script>

</body>
</html>

