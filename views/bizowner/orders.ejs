<%- include('../partials/head', { title: 'Orders' }) %>
<!--
I declare that this code was written by me.
I will not copy or allow others to copy my code.
I understand that copying code is considered as plagiarism.

Student Name: Raphaela Lee
Student ID: 24009059
Class: c004
Date created: February 5, 2026
-->

<%- include('../partials/navbar-bizowner') %>

<style>
  body { background: #faefe5; color:#2a241e; }
  .orders-wrap { max-width: 1100px; margin: 26px auto 60px; padding: 0 18px; }
  .orders-card { background:#fffdf8; border:1px solid #f1dfbb; border-radius:16px; box-shadow:0 10px 24px rgba(0,0,0,0.06); padding:18px; }
  h2 { font-weight:900; margin:0 0 14px; }
  table { width:100%; border-collapse:collapse; }
  thead th { background:#f7eedf; padding:12px 10px; font-weight:800; color:#2f2a24; border-color:#f1dfbb; }
  tbody td { padding:12px 10px; border-color:#f1dfbb; }
  tbody tr:nth-child(every) {}
  .status-pill{
    display:inline-flex; padding:6px 10px; border-radius:999px; font-size:12px; font-weight:700; text-transform:capitalize;
  }
  .paid{ background:#e6f6e9; color:#1b7a2e; }
  .pending{ background:#fff4dc; color:#8c6a00; }
  .completed{ background:#e9e7ff; color:#3f3ba6; }
  .btn-view{
    border:1px solid #dd9b00;
    color:#dd9b00;
    border-radius:10px;
    padding:6px 12px;
    font-weight:700;
    text-decoration:none;
    font-family: inherit;
    background: transparent;
  }
  .btn-view:hover{ background:#dd9b00; color:white; }
</style>

<div class="orders-wrap">
  <h2>Orders</h2>
  <div class="orders-card">
    <div class="table-responsive">
      <table class="table align-middle mb-0">
        <thead>
          <tr>
            <th>Order #</th>
            <th>Date</th>
            <th class="text-end">Total</th>
            <th class="text-end">Customer Points</th>
            <th>Status</th>
            <th class="text-end">Action</th>
          </tr>
        </thead>
        <tbody>
          <% if (!orders || orders.length === 0) { %>
            <tr>
              <td colspan="5" class="text-center text-muted py-4">No orders found.</td>
            </tr>
          <% } else { %>
            <% orders.forEach(o => { 
              const orderNum = o.orderRef || `ORD-${o.id}`;
              const statusKey = (o.fulfillmentStatus || '').toLowerCase();
              const statusLabel = statusKey === 'completed' ? 'Completed' : (statusKey === 'paid' ? 'Paid' : 'Pending');
              const statusClass = statusKey === 'completed' ? 'completed' : (statusKey === 'paid' ? 'paid' : 'pending');
            %>
              <tr>
                <td style="font-weight:700;"><%= orderNum %></td>
                <td><%= o.created_at ? new Date(o.created_at).toLocaleString() : '-' %></td>
                <td class="text-end">$<%= Number(o.total||0).toFixed(2) %></td>
                <td class="text-end"><%= Number(o.customerPoints || 0) %></td>
                <td><span class="status-pill <%= statusClass %>"><%= statusLabel %></span></td>
                <td class="text-end">
                  <a class="btn-view" href="/bizowner/orders/<%= o.id %>">View</a>
                  <% if (statusKey !== 'completed') { %>
                    <form action="/bizowner/orders/<%= o.id %>/complete" method="POST" style="display:inline;" onsubmit="return confirm('Mark this order as completed?');">
                      <button type="submit" class="btn-view" style="margin-left:6px;">Complete</button>
                    </form>
                  <% } %>
                </td>
              </tr>
            <% }) %>
          <% } %>
        </tbody>
      </table>
    </div>
  </div>
</div>
