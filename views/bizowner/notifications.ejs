<%- include('../partials/head', { title: 'Notifications' }) %>
<!--
I declare that this code was written by me.
I will not copy or allow others to copy my code.
I understand that copying code is considered as plagiarism.

Student Name: Raphaela Lee
Student ID: 24009059
Class: c004
Date created: February 5, 2026
-->

<%- include('../partials/navbar-bizowner') %>

<style>
  body { background:#faefe5; color:#2a241e; }
  .notif-wrap { max-width: 1100px; margin: 26px auto 60px; padding: 0 18px; }
  .notif-card { background:#fffdf8; border:1px solid #f1dfbb; border-radius:16px; box-shadow:0 10px 24px rgba(0,0,0,0.06); padding:18px; }
  h2 { font-weight:900; margin:0 0 14px; }
  .section { margin-top: 18px; }
  .section-title { font-weight:800; margin:0 0 10px; font-size:16px; }
  .list { display:grid; gap:10px; }
  .row {
    border:1px solid #f1dfbb;
    background:#fff7ea;
    border-radius:12px;
    padding:12px 14px;
    display:flex;
    justify-content:space-between;
    align-items:flex-start;
    gap:12px;
    flex-wrap:wrap;
  }
  .row strong { color:#2f2a24; }
  .meta { font-size:12px; color:#6d6151; }
  .actions { display:flex; gap:8px; }
  .btn-view{
    border:1px solid #dd9b00;
    color:#dd9b00;
    border-radius:10px;
    padding:6px 12px;
    font-weight:700;
    text-decoration:none;
    font-family: inherit;
    background: transparent;
  }
  .btn-view:hover{ background:#dd9b00; color:white; }
  .empty { color:#6d6151; font-size:13px; padding:8px 0; }
</style>

<div class="notif-wrap">
  <h2>Notification Inbox</h2>

  <div class="notif-card">
    <div class="section">
      <div class="section-title" style="display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap;">
        <span>Unread Messages</span>
        <% if (unreadMessages && unreadMessages.length) { %>
          <form action="/bizowner/notifications/mark-read" method="POST" style="margin:0;">
            <button type="submit" class="btn-view">Mark all as read</button>
          </form>
        <% } %>
      </div>
      <% if (!unreadMessages || unreadMessages.length === 0) { %>
        <div class="empty">No unread messages.</div>
      <% } else { %>
        <div class="list">
          <% unreadMessages.forEach(m => { %>
            <div class="row">
              <div>
                <div><strong><%= m.senderName || 'Customer' %></strong> <% if (m.senderEmail) { %>· <span class="meta"><%= m.senderEmail %></span><% } %></div>
                <div class="meta"><%= m.created_at ? new Date(m.created_at).toLocaleString() : '-' %></div>
                <div style="margin-top:6px;"><%= m.message %></div>
              </div>
              <div class="actions">
                <a class="btn-view" href="/bizowner/messages">View</a>
              </div>
            </div>
          <% }) %>
        </div>
      <% } %>
    </div>

    <div class="section">
      <div class="section-title">Pending Orders</div>
      <% if (!pendingOrders || pendingOrders.length === 0) { %>
        <div class="empty">No pending orders.</div>
      <% } else { %>
        <div class="list">
          <% pendingOrders.forEach(o => { %>
            <div class="row">
              <div>
                <div><strong><%= o.orderRef %></strong> · $<%= Number(o.total || 0).toFixed(2) %></div>
                <div class="meta"><%= o.created_at ? new Date(o.created_at).toLocaleString() : '-' %></div>
                <div class="meta" style="margin-top:4px;">Status: <%= String(o.status || 'pending') %></div>
              </div>
              <div class="actions">
                <a class="btn-view" href="/bizowner/orders/<%= o.id %>">View</a>
              </div>
            </div>
          <% }) %>
        </div>
      <% } %>
    </div>
  </div>
</div>

<%- include('../partials/foot') %>
